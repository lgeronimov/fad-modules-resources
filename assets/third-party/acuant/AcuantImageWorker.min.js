"use strict";importScripts("AcuantImageService.min.js"),AcuantImageModule().then((e=>{let a=e.addFunction(n,"viiiii"),r=e.addFunction(s,"viiiiiiiii"),t=e.addFunction(o,"vii"),i=e.addFunction(c,"vi");function n(a,r,t,i,n){let s={func:"crop"};if(t>=0){const o=new ArrayBuffer(r);let c=new Uint8Array(o);c.set(e.HEAPU8.subarray(a,a+r),0),s.imgData=c,s.width=t,s.height=i,s.type=n}else switch(t){case-1:s.error="Runtime error.";break;case-2:s.error="Detect (for cropping) did not return OK";break;case-3:s.error="Crop did not return OK";break;default:s.error="Unknown Error Occured"}s&&s.imgData&&s.imgData.buffer?postMessage(s,[s.imgData.buffer]):postMessage(s)}function s(e,a,r,t,i,n,s,o,c){let l={func:"detect"};if(a>=0)l.type=e,l.x1=a,l.y1=r,l.x2=t,l.y2=i,l.x3=n,l.y3=s,l.x4=o,l.y4=c;else switch(a){case-1:l.error="Runtime error.";break;case-2:l.error="Detect did not return OK";break;default:l.error="Unknown Error Occured"}postMessage(l)}function o(a,r){let t={func:"sign"};if(a){const i=new ArrayBuffer(r);let n=new Uint8Array(i);n.set(e.HEAPU8.subarray(a,a+r),0),t.imgData=n}else switch(r){case-1:t.error="Failed to sign image: SIGN_PARSE_ERROR";break;case-2:t.error="Failed to sign image: SIGN_CANNOT_SIGN";break;case-3:t.error="Failed to sign image: SIGN_HASH_ERROR";break;default:t.error="Failed to sign image: UNEXPECTED"}t&&t.imgData&&t.imgData.buffer?postMessage(t,[t.imgData.buffer]):postMessage(t)}function c(e){postMessage({func:"verify",result:e})}function l(a){null!=a&&(e._free(a),a=null)}function u(a){var r=e._malloc(a.length*a.BYTES_PER_ELEMENT);return e.HEAPU8.set(a,r),r}onmessage=g=>{if(g&&g.data)if("crop"===g.data.func){let r=g.data.data;if(r.imgData&&r.width&&r.height){let t=u(r.imgData);e.ccall("acuantCrop",null,["number","number","number","number"],[t,r.width,r.height,a]),l(t)}else console.error("missing params"),n(-1,-1,-1,-1)}else if("detect"===g.data.func){let a=g.data.data;if(a.imgData&&a.width&&a.height){let t=u(a.imgData);e.ccall("acuantDetect",null,["number","number","number","number"],[t,a.width,a.height,r]),l(t)}else console.error("missing params"),s(-1,-1,-1,-1,-1,-1,-1,-1,-1)}else if("sign"===g.data.func){let a=g.data.data;if(a.imgData){let r=u(a.imgData);e.ccall("acuantSign",null,["number","number","number"],[r,a.imgData.byteLength,t]),l(r)}else console.error("missing params"),o(null,-1)}else if("verify"==g.data.func){let a=g.data.data;if(a.imgData){let r=u(a.imgData);e.ccall("acuantVerify",null,["number","number","number"],[r,a.imgData.byteLength,i]),l(r)}else console.log("missing params"),c(null)}else console.error("called with no func specified")},postMessage({imageWorker:"started"})}));